//! Carmen
//! version : 0.1.0
//! author  : Tal Ater @TalAter
//! license : MIT
//! https://github.com/TalAter/Carmen
(function(t){"use strict";var n=this,r=navigator.geolocation;if(!r)return n.Carmen=null,t;var a,i={},e=Math.PI/180,o=function(t,n){var r=t.latitude,a=n.latitude,i=t.longitude,o=n.longitude,s=r*e,u=a*e,c=(a-r)*e,d=(o-i)*e,f=Math.sin(c/2)*Math.sin(c/2)+Math.cos(s)*Math.cos(u)*Math.sin(d/2)*Math.sin(d/2);return 6371*(2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)))},s=function(t,n){return 1e3*o(t,n.coords)<=n.radius},u=function(t){for(var n in i)if(i.hasOwnProperty(n)){var r=i[n],a=s(t.coords,r);a&&(r.inhabited||r.fn()),r.inhabited=a}},c=function(t){return t=t.replace(/[^\d\,\-\.]/,""),t=t.split(","),{latitude:parseFloat(t[0]),longitude:parseFloat(t[1])}},d=function(t){return parseFloat(t.replace(/[^\d\,\-\.]/,""))};n.Carmen={addFences:function(t){for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];i[n]={coords:c(r.coords),radius:d(r.radius||"500m"),fn:r.fn,inhabited:!1}}},getFences:function(){return i},removeFences:function(n){if(n===t)return void(i={});(n=Array.isArray(n)?n:[n]).forEach(function(t){delete i[t]})},start:function(){return!a&&(a=r.watchPosition(u),!0)}}}).call(this);